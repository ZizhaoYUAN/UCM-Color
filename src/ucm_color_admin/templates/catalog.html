{% extends "base.html" %}

{% block title %}商品资料 · UCM Color 管理后台{% endblock %}
{% block heading %}商品资料{% endblock %}

{% block header_actions %}
  <div style="margin-top: 0.5rem; display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
    <span style="font-weight: 600;">当前用户：{{ current_user.username }}</span>
    <a class="button" href="/web/dashboard">返回主控台</a>
    <a class="button" href="/web/logout">退出</a>
  </div>
{% endblock %}

{% block content %}
  <div class="card" style="margin-bottom: 1rem;">
    <div style="display: flex; justify-content: space-between; align-items: flex-end; gap: 1rem; flex-wrap: wrap;">
      <div>
        <h2 style="margin: 0 0 0.35rem 0;">商品资料维护</h2>
        <p style="margin: 0; color: #475569;">支持新增商品、批量导入/导出商品资料，带查询和编辑入口。</p>
      </div>
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a class="button" href="#create">新增商品</a>
        <a class="button" href="#import">导入商品资料</a>
        <a class="button" href="#export">导出商品资料</a>
      </div>
    </div>
  </div>

  <div class="card" id="create">
    <h3 style="margin-top: 0;">新增商品</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem;">
      <div>
        <label>SKU</label>
        <input type="text" placeholder="例如 SKU-003" />
      </div>
      <div>
        <label>商品条码（多条码）</label>
        <input type="text" placeholder="逗号分隔多个条码，如 6901...,6920..." />
      </div>
      <div>
        <label>分类</label>
        <input type="text" placeholder="如 饮料/水饮" />
      </div>
      <div>
        <label>包装规格</label>
        <input type="text" placeholder="如 箱装 12×500ml" />
      </div>
      <div>
        <label>单位</label>
        <input type="text" placeholder="箱/袋/瓶" />
      </div>
      <div>
        <label>价格（销售/会员/临时调价，含生效时间）</label>
        <input type="text" placeholder="销售价 5.9@2024-01-01; 会员价 5.2@2024-01-01" />
      </div>
      <div>
        <label>税率</label>
        <input type="text" placeholder="如 13%" />
      </div>
      <div>
        <label>品牌</label>
        <input type="text" placeholder="品牌名称" />
      </div>
      <div>
        <label>产地</label>
        <input type="text" placeholder="中国/进口" />
      </div>
      <div>
        <label>保质期</label>
        <input type="text" placeholder="如 365 天" />
      </div>
      <div>
        <label>商品图片（最多 5 张）</label>
        <input type="file" multiple />
      </div>
      <div>
        <label>商品视频</label>
        <input type="file" />
      </div>
    </div>
    <div style="margin-top: 1rem; display: flex; gap: 0.75rem;">
      <button type="button">保存商品</button>
      <button type="button" style="background: #0f172a;">保存并继续新增</button>
    </div>
  </div>

  <div class="card" id="import">
    <h3 style="margin-top: 0;">批量导入/导出</h3>
    <p style="margin-top: 0; color: #475569;">导入前会自动校验并提供差异预览，支持 CSV/Excel。</p>
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
      <button type="button">上传 CSV/Excel 导入</button>
      <button type="button">下载导入模板</button>
      <button type="button" id="export">导出当前查询结果</button>
    </div>
  </div>

  <div class="card" id="search">
    <form method="get" action="/web/catalog" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; align-items: end;">
      <div>
        <label>SKU/名称/条码查询</label>
        <input type="text" name="q" value="{{ q }}" placeholder="输入 SKU、关键字或条码" />
      </div>
      <div>
        <button type="submit">查询商品</button>
      </div>
    </form>
  </div>

  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
      <h3 style="margin: 0;">商品列表</h3>
      <a class="button" href="#create">新增商品</a>
    </div>
    <div style="overflow-x: auto; margin-top: 0.5rem;">
      <table>
        <thead>
          <tr>
            <th>SKU</th>
            <th>条码</th>
            <th>分类/包装/单位</th>
            <th>价格（含生效时间）</th>
            <th>税率</th>
            <th>品牌/产地</th>
            <th>保质期</th>
            <th>图片/视频</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {% if products %}
            {% for item in products %}
              <tr>
                <td style="white-space: nowrap;">
                  <div style="font-weight: 700;">{{ item.sku }}</div>
                  <div style="color: #475569;">{{ item.title }}</div>
                </td>
                <td>
                  <div style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                    {% for code in item.barcodes %}
                      <span style="background: #e0f2fe; color: #075985; padding: 0.25rem 0.45rem; border-radius: 0.4rem; font-weight: 700;">{{ code }}</span>
                    {% endfor %}
                  </div>
                </td>
                <td>
                  <div>{{ item.category }}</div>
                  <div style="color: #475569;">{{ item.package }} · {{ item.unit }}</div>
                </td>
                <td>
                  <ul style="margin: 0; padding-left: 1rem; color: #0f172a;">
                    {% for price in item.pricing %}
                      <li>{{ price.label }}：¥{{ '%.2f'|format(price.value) }}（{{ price.effective }} 生效）</li>
                    {% endfor %}
                  </ul>
                </td>
                <td>{{ item.tax }}</td>
                <td>
                  <div>{{ item.brand }}</div>
                  <div style="color: #475569;">{{ item.origin }}</div>
                </td>
                <td>{{ item.shelf_life }}</td>
                <td>
                  <div>图片 {{ item.media.images }} 张</div>
                  <div>视频 {{ item.media.videos }} 个</div>
                </td>
                <td>
                  <div style="display: flex; flex-direction: column; gap: 0.35rem;">
                    <button type="button" style="width: 100%;">编辑</button>
                    <button type="button" style="width: 100%; background: #0f172a;">查看详情</button>
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="9" style="text-align: center; color: #94a3b8;">没有符合条件的商品资料</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
